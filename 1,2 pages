import streamlit as st
import requests
import time
from PIL import Image

def home_page():
    logo_text = " "
    logo_html = f"""
    <div style="position: absolute; top: -50px; right: -100px;">
        <h1 style="font-size: 24px;">{logo_text}</h1>
    </div>
    """
    st.markdown(logo_html, unsafe_allow_html=True)
    image = Image.open('logowbg.png')
    st.title('YUMSCAN')
    st.header('K-FOOD : From Seoul to your soul.')

    st.markdown("<style>h1{margin-bottom: 10px;}</style>", unsafe_allow_html=True)


    if "photo" not in st.session_state:
        st.session_state["photo"] = "not done"

    col1, col2 = st.columns([5, 3])

    def change_photo_state():
        st.session_state["photo"] = "done"

    uploaded_photo = col1.file_uploader("Upload a photo", on_change=change_photo_state)
    camera_photo = col1.camera_input("Take a photo", on_change=change_photo_state)

    if st.session_state["photo"] == "done":
        progress_bar = col1.progress(0)

        for perc_completed in range(100):
            time.sleep(0.05)
            progress_bar.progress(perc_completed + 1)

        col1.success("Photo uploaded successfully!")

    if st.session_state["photo"] == "done" and col1.button("Submit"):
        with st.expander("Preview"):
            st.write("Please double-check that you have submitted all desired photo")

            if uploaded_photo is None:
                st.image(camera_photo)
            else:
                st.image(uploaded_photo)

    col2.markdown("""
        <div style="border: 1px solid black; padding: 10px;">
            <h2>Instructions</h2>
            <p>Welcome to K-FOOD's YUMSCAN!</p>
            <p>1. Use the dropdown to select your preferred language.</p>
            <p>2. You can either upload a photo by clicking 'Upload a photo' or take a photo using the 'Take a photo' button.</p>
            <p>3. Click the 'Submit' button after uploading or taking a photo to view the preview.</p>
            <p>4. Double-check your photo in the preview section before submitting.</p>
            <p>5. Enjoy the app and discover the delicious world of K-FOOD!</p>
        </div>
    """, unsafe_allow_html=True)

def food_info_page():
    st.title("Choose the food you want to get information")
    st.markdown("<p style='font-size: 25px;'>1.pizza</p>", unsafe_allow_html=True)
    st.markdown("<p style='font-size: 25px;'>2.pasta</p>", unsafe_allow_html=True)
    st.markdown("<p style='font-size: 25px;'>3.coke</p>", unsafe_allow_html=True)

def Ingredients():
# ìŒì‹ì— ë“¤ì–´ìˆëŠ” ì¬ë£Œì— ëŒ€í•œ ì‚¬ì§„ê³¼ ì„¤ëª… 
    st.title("Ingredients")
    st.markdown("<p style='font-size: 20px;'>The ingredients in this food are as follows.</p>", unsafe_allow_html=True)
    st.write(" ")

    cols = st.columns(3)

    # ì²« ë²ˆì§¸ ì¬ë£Œ ì •ë³´ (ì´ë¯¸ì§€ì™€ ì„¤ëª…)
    with cols[0]:
        st.image("vegetable.png", use_column_width=True)
        st.write("ì²« ë²ˆì§¸ ì¬ë£Œ ì„¤ëª…")
    
    # ë‘ ë²ˆì§¸ ì¬ë£Œ ì •ë³´ (ì´ë¯¸ì§€ì™€ ì„¤ëª…)
    with cols[1]:
        st.image("vegetable.png", use_column_width=True)
        st.write("ë‘ ë²ˆì§¸ ì¬ë£Œ ì„¤ëª…")

    # ì„¸ ë²ˆì§¸ ì¬ë£Œ ì •ë³´ (ì´ë¯¸ì§€ì™€ ì„¤ëª…)
    with cols[2]:
        st.image("vegetable.png", use_column_width=True)
        st.write("ì„¸ ë²ˆì§¸ ì¬ë£Œ ì„¤ëª…")


def allergen_page():
    st.title("Allergen Information")
    st.markdown("<p style='font-size: 20px;'>This food can cause the following allergies.</p>", unsafe_allow_html=True)
    st.write(" ")
    st.write(" ")

    # ì•ŒëŸ¬ì§€ì— ëŒ€í•œ ì‚¬ì§„ê³¼ ì„¤ëª…
    allergy_data = {
        "image": "vegetable.png",
        "description": "ì•ŒëŸ¬ì§€ì— ëŒ€í•œ ì„¤ëª…ì…ë‹ˆë‹¤."
    }

    cols = st.columns(2)

    with cols[0]:
        st.image(allergy_data["image"], width=200)

    with cols[1]:
        st.write(allergy_data["description"])

def spiciness_page():
    st.title("Spiciness Level")

# ê° ìŒì‹ì˜ ê¸°ë³¸ ë§µê¸° ë‹¨ê³„ ì„¤ì •
    spiciness_levels = {
        "íŒŒìŠ¤íƒ€": 1,
        "í”¼ì": 2,
        "ì¹˜í‚¨": 3,
        "ì½œë¼": 0,
        "ì¹˜ì¦ˆ": None
    }

    # ìŒì‹ ëª©ë¡ ìƒì„±
    foods = list(spiciness_levels.keys())

    # ìŒì‹ ì„ íƒ
    selected_food = st.selectbox("ìŒì‹ ì„ íƒ", foods)

    # null ê°’ì„ ì„ íƒí•œ ê²½ìš°
    if selected_food == "ì¹˜ì¦ˆ":
        is_null = st.write("UNKNOWN")
        if is_null:
            spicy_level = None
        else:
        # "ì¹˜ì¦ˆ"ì¸ ê²½ìš° ìŠ¬ë¼ì´ë”ë°”ë¥¼ ë¹„í™œì„±í™”í•˜ê³  ë¶ˆíˆ¬ëª…í•˜ê²Œ í‘œì‹œ
            with st.empty():
                spicy_level = None
    else:
        spicy_level = st.slider("ë§µê¸° ë‹¨ê³„", min_value=0, max_value=3, value=spiciness_levels[selected_food], step=1, format="ğŸŒ¶ï¸ %d")

    # ì„ íƒëœ ë§µê¸° ë‹¨ê³„ì™€ null ì—¬ë¶€ì— ë”°ë¼ ê²°ê³¼ ì¶œë ¥
    if spicy_level is None:
        st.write(f"{selected_food}ì˜ ë§µê¸° ë‹¨ê³„: Null")
    else:
        st.write(f"{selected_food}ì˜ ë§µê¸° ë‹¨ê³„:", spicy_level)


def exchange_rate_page():
    def get_exchange_rates(api_key):
        url = f"https://api.currencyfreaks.com/latest?apikey=21a31a1e5b4346b3877828cea5953658"
        headers = {
            "apikey": api_key
        }
        response = requests.get(url, headers=headers)
        data = response.json()
        return data["rates"]

    base_currency = "USD"  # ê¸°ì¤€ í™”í
    target_currencies = ["USD", "JPY", "CNY", "TWD"]  # ëŒ€ìƒ í™”íë“¤
    api_key = "21a31a1e5b4346b3877828cea5953658"  # currencyfreaksì—ì„œ ë°œê¸‰ë°›ì€ API í‚¤ë¥¼ ì…ë ¥

    exchange_rates = get_exchange_rates(api_key)

    # í™˜ìœ¨ ì •ë³´ë¥¼ í™•ì¸
    print(exchange_rates)

    krw_exchange_rate = exchange_rates.get("KRW")
    jpy_exchange_rate = exchange_rates.get("JPY")
    cny_exchange_rate = exchange_rates.get("CNY")
    twd_exchange_rate = exchange_rates.get("TWD")

    exchange = {
        "KRW": krw_exchange_rate,  
        "JPY": jpy_exchange_rate,   
        "CNY": cny_exchange_rate,   
        "TWD": twd_exchange_rate    
    }

    # ê°€ë¡œì„  ì¶”ê°€
    #st.markdown("<hr>", unsafe_allow_html=True)

    st.header("Today's Exchange Rate")

    BASE_currency = "KRW"
    krw_exchange_rate = float(krw_exchange_rate)
    jpy_exchange_rate = float(jpy_exchange_rate)
    cny_exchange_rate = float(cny_exchange_rate)
    twd_exchange_rate = float(twd_exchange_rate)

    usd_exchange_rate = exchange_rates.get("USD")
    usd_exchange_rate = float(usd_exchange_rate)
    USD_currency = usd_exchange_rate/krw_exchange_rate

    if USD_currency is not None:
        USD_currency = float(USD_currency)
        # ë¬¸ìì—´ì„ ì‹¤ìˆ˜í˜•ìœ¼ë¡œ ë³€í™˜
        st.write(f"1000 {BASE_currency} = :blue[{USD_currency*1000:.4f} USD]")
    else:
        st.write("USDì˜ í™˜ìœ¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")

    JPY_currency = jpy_exchange_rate/krw_exchange_rate

    if JPY_currency is not None:
        JPY_currency = float(JPY_currency)
        # ë¬¸ìì—´ì„ ì‹¤ìˆ˜í˜•ìœ¼ë¡œ ë³€í™˜
        st.write(f"1000 {BASE_currency} = :blue[{JPY_currency*1000:.4f} JPY]")
    else:
        st.write("JPYì˜ í™˜ìœ¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")

    CNY_currency = cny_exchange_rate/krw_exchange_rate

    if CNY_currency is not None:
        CNY_currency = float(CNY_currency)
        # ë¬¸ìì—´ì„ ì‹¤ìˆ˜í˜•ìœ¼ë¡œ ë³€í™˜
        st.write(f"1000 {BASE_currency} = :blue[{CNY_currency*1000:.4f} CNY]")
    else:
        st.write("CNYì˜ í™˜ìœ¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")

    TWD_currency = twd_exchange_rate/krw_exchange_rate

    if TWD_currency is not None:
        TWD_currency = float(TWD_currency)
        # ë¬¸ìì—´ì„ ì‹¤ìˆ˜í˜•ìœ¼ë¡œ ë³€í™˜
        st.write(f"1000 {BASE_currency} = :blue[{TWD_currency*1000:.4f} TWD]")
    else:
        st.write("TWDì˜ í™˜ìœ¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")

    # ê°€ë¡œì„  ì¶”ê°€
    st.markdown("<hr>", unsafe_allow_html=True)

    st.title("Currency Converter")
    st.write("From:", BASE_currency)

    EXCHANGE = {
        "USD": USD_currency,  
        "JPY": JPY_currency,   
        "CNY": CNY_currency,   
        "TWD": TWD_currency   
    }

    BASE_currency = "KRW"
    target_currencies = ["USD", "JPY", "CNY", "TWD"]

    BASE = st.number_input("AMOUNT", key="BASE", min_value=0.01)

    #st.write("choose target_currencies:")
    TARGET = st.selectbox("TO", target_currencies, key="TARGET")

    converted_amount = BASE * EXCHANGE[TARGET]
    st.title(f"{BASE:.2f} {BASE_currency} = :blue[{converted_amount:.2f} {TARGET}]")

# Main app
def main():
    st.set_page_config(page_title="YumScan", page_icon=":pizza:", layout="wide")
    
    # Create a sidebar navigation menu
    image = Image.open('logowbg.png')

    st.sidebar.image("logowbg.png", use_column_width=True)
    navigation = st.sidebar.radio("YUMSCAN", ["ğŸ  Home", "ğŸ” Food Information", "ğŸ¥— Ingredients", "ğŸš« Allergen Information", "ğŸŒ¶ï¸ Spiciness Level", "ğŸ’± Currency Converter"], key="navigation")
    
    # Separator line
    st.sidebar.markdown("<div class='sidebar-separator'></div>", unsafe_allow_html=True)

    # Language selection using selectbox
    selected_language = st.sidebar.selectbox("Select Language", ["English", "Chinese", "Japanese"])
    
    if navigation == "ğŸ  Home":
        home_page()
    elif navigation == "ğŸ” Food Information":
        food_info_page()
    elif navigation == "ğŸ¥— Ingredients":
        Ingredients()
    elif navigation == "ğŸš« Allergen Information":
        allergen_page()
    elif navigation == "ğŸŒ¶ï¸ Spiciness Level":
        spiciness_page()
    elif navigation == "ğŸ’± Currency Converter":
        exchange_rate_page()

if __name__ == "__main__":
    main()

# Made with Streamlit, MainMenu ì œê±°
st.markdown('''
    <style>
        #MainMenu {
            visibility: hidden;
        }
        
        footer {
            visibility: hidden;
        }    
    </style>
    ''', unsafe_allow_html=True)  
